
<tree_map_canvas>
    <canvas ref="canvas">
    </canvas>

    <script>
        /*global treeMap*/ 

        let self = this;

        
        self.private = {

            // ファイルツリー
            tree: null,

            // 初期化
            // タグのマウント時に呼ばれるようにする
            init: function() {
                let canvas = self.refs.canvas;
                canvas.onmousewheel = self.private.onMouseWheel;
            },        

            // マウスホイール操作
            onMouseWheel: function(e) {
            },

            // 描画
            draw: function() {
                if (!self.private.tree) {
                    return;
                }

                let canvas = self.refs.canvas;
                let width = canvas.width;
                let height = canvas.height;
                let areas = treeMap.createTreeMap(self.private.tree, width, height);

                let fillStyle = [];
                let strokeStyle = [];
                for (let i = 0; i < 10; i++) {
                    fillStyle.push("hsl(" + ((0+i*30)%360) + ", 40%, 70%)");
                    strokeStyle.push("hsl(" + ((0+i*30)%360) + ", 20%, 40%)");
                }

                let c = self.refs.canvas.getContext("2d");
                for (let i = 0; i < areas.length; i++) {
                    let rect = areas[i].rect;
                    
                    // レベルに応じた色にする
                    c.fillStyle = fillStyle[areas[i].level];
                    c.fillRect(rect[0], rect[1], rect[2] - rect[0], rect[3] - rect[1]);

                    // 枠線の太さもレベルに応じる
                    c.lineWidth = Math.max(2 - areas[i].level/2, 0.5); 
                    // 枠線の色は，基準色から明度をおとしたものに
                    c.strokeStyle = strokeStyle[areas[i].level];
                    c.strokeRect(rect[0], rect[1], rect[2] - rect[0], rect[3] - rect[1]);
                }

                for (let i = 0; i < areas.length; i++) {
                    let rect = areas[i].rect;

                    // 文字領域が確保できた場合は描画
                    if (rect[2] - rect[0] > 80 && rect[3] - rect[1] > 40) {

                        // 1回太めに文字の枠線を書く
                        c.font = "bold 15px Century Gothic";
                        c.lineWidth = 4; 
                        c.strokeStyle = strokeStyle[areas[i].level];
                        c.strokeText(areas[i].key, rect[0] + 5, rect[1] + 15 + 5);

                        // 次に白を重ねて書く
                        c.fillStyle = "rgb(255,255,255)";
                        c.fillText(areas[i].key, rect[0] + 5, rect[1] + 15 + 5);
                    }
                }
            }

        };

        // ファイルツリー情報をセット
        self.setTree = function(tree) {
            self.private.tree = tree;
            self.private.draw();
        };

        // エントリポイント
        // マウント時に初期化を行う
        self.on("mount", self.private.init);

        // サイズを適用
        self.on("update", function() {
            let canvas = self.refs.canvas;
            canvas.width = self.width;
            canvas.height = self.height;
            self.private.draw();
        });
    </script>
</tree_map_canvas>
